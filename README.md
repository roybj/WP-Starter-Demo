# 🚀 WordPress WP Starter - Developer Setup Guide

A modern WordPress development environment using **WP Starter 3.0** (Bedrock-style architecture) with **Docker Compose**, **Nginx**, **PHP-FPM 8.2**, **MySQL 8.0**, and **Redis**.

## 📋 Table of Contents

- [Prerequisites](#prerequisites)
- [Quick Start (5 minutes)](#quick-start-5-minutes)
- [Project Architecture](#project-architecture)
- [Directory Structure](#directory-structure)
- [Development Workflow](#development-workflow)
- [Common Tasks](#common-tasks)
- [Accessing Services](#accessing-services)
- [Troubleshooting](#troubleshooting)
- [Plugin & Theme Management](#plugin--theme-management)
- [Database Management](#database-management)
- [Production Deployment](#production-deployment)

---

## Prerequisites

Before you start, ensure you have:

- **Docker Desktop** (v4.0+) - [Download](https://www.docker.com/products/docker-desktop)
- **Git** - [Download](https://git-scm.com/)
- **4GB+ RAM** allocated to Docker
- **10GB free disk space** for volumes and containers

**Verify Installation:**
```bash
docker --version
docker-compose --version
git --version
```

---

## Quick Start (5 minutes)

### 1. Clone & Setup

```bash
# Clone the repository
git clone <your-repo-url>
cd BB-WP_Template

# Copy environment template
cp .env.example .env

# Optional: Customize .env for your local setup
# (usually not needed for initial setup)
```

### 2. Start Docker Environment

```bash
# Start all services (downloads images on first run - may take 2-3 minutes)
docker-compose up -d

# Watch the startup process (optional)
docker-compose logs -f wordpress

# Wait for all containers to show "Up" status
docker-compose ps
```

### 3. Access Your Site

| Service | URL | Login |
|---------|-----|-------|
| **WordPress Site** | http://localhost:8080 | - |
| **WordPress Admin** | http://localhost:8080/wp/wp-admin | admin/admin |
| **phpMyAdmin** | http://localhost:8081 | root/root_secure_password |
| **MailHog** | http://localhost:8025 | - (email testing) |
| **Redis Commander** | http://localhost:8082 | - |

### 4. Stop When Done

```bash
# Stop all containers (data preserved)
docker-compose down

# Stop and remove all data (clean reset)
docker-compose down -v
```

---

## Project Architecture

### WP Starter 3.0 (Bedrock-Style)

This project follows the Bedrock WordPress architecture:

```
Project Root
├── web/              ← Document root (public files only)
│   ├── index.php     ← Entry point
│   ├── app/uploads/  ← User uploads directory
│   └── ...
├── wp/               ← WordPress core (managed by Composer)
│   ├── wp-admin/
│   ├── wp-includes/
│   ├── wp-content/   ← Symlink to ../wp-content
│   └── ...
├── wp-content/       ← Plugins, themes, mu-plugins
│   ├── plugins/
│   ├── themes/
│   ├── mu-plugins/
│   ├── uploads/      ← User-generated content
│   └── ...
├── vendor/           ← Composer dependencies
├── wp-config.php     ← Generated by WP Starter
├── .env              ← Environment configuration (NOT in repo)
└── docker-compose.yml ← Docker orchestration
```

### Why This Architecture?

✅ **Security**: Only web-accessible files in `web/` directory  
✅ **Scalability**: Easy to manage with Composer  
✅ **Git-friendly**: Exclude vendor, uploads, WordPress core  
✅ **Team-friendly**: Each dev runs identical environment  

---

## Directory Structure

```
BB-WP_Template/
├── docker/                          # Docker configuration
│   ├── nginx/
│   │   ├── nginx.conf              # Nginx main config
│   │   └── wordpress.conf          # Virtual host config
│   ├── php/
│   │   └── php.ini                 # PHP settings
│   ├── mysql/
│   │   ├── conf.d/
│   │   │   └── wordpress.cnf       # MySQL configuration
│   │   └── init/
│   │       └── 01-init-wordpress.sql # Database initialization
│   ├── redis/
│   │   └── redis.conf              # Redis configuration
│   ├── Dockerfile.wordpress        # WordPress/PHP container
│   ├── Dockerfile.wpcli            # WP-CLI container
│   └── scripts/
│       ├── start.sh                # WordPress startup script
│       ├── dev.sh                  # Development helper
│       └── ...
├── web/                             # Public document root
│   ├── index.php                   # Entry point
│   └── app/uploads/                # Uploads directory
├── wp/                              # WordPress core (auto-installed)
│   ├── wp-admin/
│   ├── wp-includes/
│   └── wp-content/ → ../wp-content # Symlink
├── wp-content/                      # Themes, plugins, uploads
│   ├── plugins/                    # Installed via Composer
│   ├── themes/                     # Installed via Composer
│   ├── mu-plugins/                 # Must-use plugins
│   └── uploads/                    # User-generated content
├── vendor/                          # Composer dependencies
├── docker-compose.yml              # Docker Compose orchestration
├── composer.json                   # PHP dependencies
├── composer.lock                   # Locked versions
├── .env.example                    # Environment template
├── .gitignore                      # Git exclusions
├── Makefile                        # Development commands
├── wp-cli.yml                      # WP-CLI configuration
├── DOCKER-README.md                # Docker documentation
└── README.md                       # This file
```

---

## Development Workflow

### 1. Starting Fresh

```bash
# 1. Copy environment file
cp .env.example .env

# 2. Start containers
docker-compose up -d

# 3. Wait for WordPress initialization (check logs)
docker-compose logs -f wordpress

# 4. Access http://localhost:8080/wp/wp-admin
# Complete WordPress installation setup
```

### 2. Installing Composer Packages

```bash
# Install PHP dependencies
docker-compose exec wordpress composer install

# Add a new package
docker-compose exec wordpress composer require vendor/package-name

# Update packages
docker-compose exec wordpress composer update
```

### 3. Installing Plugins (2 methods)

**Method A: Via Composer (Recommended for production)**

```bash
# Add plugin from WPackagist
docker-compose exec wordpress composer require wpackagist-plugin/plugin-slug

# Check available plugins
# Visit: https://wpackagist.org
```

**Method B: Via WP-Admin (Development only)**

```bash
# If DISALLOW_FILE_MODS=false in .env, you can:
# 1. Go to http://localhost:8080/wp/wp-admin
# 2. Navigate to Plugins → Add New
# 3. Search and install plugins
# 4. Commit the plugin files to Git
```

### 4. Installing Themes

```bash
# Via Composer
docker-compose exec wordpress composer require wpackagist-theme/theme-slug

# Or via WP-Admin (if DISALLOW_FILE_MODS=false)
# Go to Appearance → Themes → Add New
```

### 5. Theme/Plugin Development

```bash
# SSH into WordPress container
docker-compose exec wordpress bash

# Navigate to your theme
cd wp-content/themes/your-theme

# Use Node for asset building
docker-compose exec nodejs npm install
docker-compose exec nodejs npm run build
```

---

## Common Tasks

### Using Makefile (Shortcut commands)

```bash
# Show all available commands
make help

# Start development environment
make start

# Stop all services
make stop

# View logs
make logs
make logs wordpress          # Specific service
make logs -f nginx          # Nginx logs

# Access container shell
make shell

# Run WP-CLI commands
make wp -- plugin list
make wp -- user list
make wp -- search-replace oldurl.com newurl.com
```

### Using Docker Compose Directly

```bash
# Start services
docker-compose up -d

# Stop services
docker-compose down

# View logs
docker-compose logs -f

# Execute commands in container
docker-compose exec wordpress bash
docker-compose exec wordpress composer install
docker-compose exec wordpress wp plugin list

# Rebuild containers
docker-compose build --no-cache
docker-compose up -d
```

### Running WP-CLI Commands

```bash
# Information
docker-compose exec wordpress wp --info

# WordPress installation
docker-compose exec wordpress wp core install \
  --url=http://localhost:8080 \
  --title="Site Title" \
  --admin_user=admin \
  --admin_password=admin \
  --admin_email=admin@example.com

# Plugin management
docker-compose exec wordpress wp plugin list
docker-compose exec wordpress wp plugin install plugin-name --activate
docker-compose exec wordpress wp plugin deactivate plugin-name

# Theme management
docker-compose exec wordpress wp theme list
docker-compose exec wordpress wp theme activate theme-name

# User management
docker-compose exec wordpress wp user list
docker-compose exec wordpress wp user create newuser user@example.com --role=editor
```

---

## Accessing Services

### 🌐 Web Services

| Service | URL | Port | Purpose |
|---------|-----|------|---------|
| WordPress | http://localhost:8080 | 8080 | Main site |
| phpMyAdmin | http://localhost:8081 | 8081 | Database management |
| MailHog | http://localhost:8025 | 8025 | Email testing |

### 🔌 Internal Services (Container Names)

These are used within Docker containers:

| Service | Host | Port | Purpose |
|---------|------|------|---------|
| WordPress | wordpress | 9000 | PHP-FPM |
| MySQL | mysql | 3306 | Database |
| Redis | redis | 6379 | Cache |
| Nginx | nginx | 80 | Web server |
| MailHog | mailhog | 1025 | SMTP |

### 📊 Viewing Container Logs

```bash
# All containers
docker-compose logs -f

# Specific container
docker-compose logs -f wordpress
docker-compose logs -f nginx
docker-compose logs -f mysql

# Last 50 lines
docker-compose logs --tail=50 wordpress

# Follow new logs only (no history)
docker-compose logs -f --tail=0 wordpress
```

---

## Troubleshooting

### 🔴 "502 Bad Gateway" Error

**Symptoms**: Nginx error when accessing the site

**Solutions**:
```bash
# 1. Check WordPress container status
docker-compose ps wordpress

# 2. View WordPress logs
docker-compose logs wordpress

# 3. Restart containers
docker-compose restart

# 4. Check database connection
docker-compose exec wordpress wp --info
```

### 🔴 "Cannot connect to database"

**Symptoms**: WordPress cannot connect to MySQL

**Solutions**:
```bash
# 1. Check MySQL is running
docker-compose ps mysql

# 2. View MySQL logs
docker-compose logs mysql

# 3. Check .env database settings
# Ensure DB_HOST=mysql (not localhost)
# Ensure DB_USER and DB_PASSWORD match docker-compose.yml

# 4. Restart MySQL
docker-compose restart mysql
```

### 🔴 "Port already in use" Error

**Symptoms**: Error like "Address already in use: 0.0.0.0:8080"

**Solutions**:
```bash
# 1. Find process using port
# On Windows:
netstat -ano | findstr :8080

# On Mac/Linux:
lsof -i :8080

# 2. Kill process or change port in docker-compose.yml
# Edit docker-compose.yml and change "8080:80" to "8081:80"
```

### 🔴 "Composer out of memory"

**Symptoms**: Memory exhaustion during composer install

**Solutions**:
```bash
# 1. Increase Docker memory allocation in Docker Desktop settings

# 2. Or run Composer with memory limit
docker-compose exec wordpress php -d memory_limit=-1 $(which composer) install
```

### 🔴 "Permission denied" errors

**Symptoms**: Cannot write to wp-content, uploads directories

**Solutions**:
```bash
# 1. Fix permissions in container
docker-compose exec wordpress chown -R www-data:www-data wp-content/
docker-compose exec wordpress chown -R www-data:www-data web/app/uploads/

# 2. Or run as Docker root user
docker-compose exec -u root wordpress chown -R www-data:www-data wp-content/
```

### 🔴 "Container keeps restarting"

**Symptoms**: `docker-compose ps` shows "Restarting (1)" status

**Solutions**:
```bash
# 1. View detailed logs
docker-compose logs wordpress

# 2. Check for PHP errors
docker-compose exec wordpress php -l

# 3. Rebuild container
docker-compose build --no-cache
docker-compose up -d
```

---

## Plugin & Theme Management

### Installing Plugins with Composer

**Best Practice**: Use Composer for version control and reproducibility

```bash
# 1. Find plugin on WPackagist
# Visit: https://wpackagist.org/?search=plugin-name

# 2. Install via Composer
docker-compose exec wordpress composer require wpackagist-plugin/plugin-name

# 3. Commit changes
git add composer.json composer.lock wp-content/plugins/
git commit -m "Add plugin-name plugin"

# 4. Other developers auto-install on pull:
docker-compose exec wordpress composer install
```

### Installing Custom Plugins

```bash
# 1. Place plugin in wp-content/plugins/your-plugin/
# 2. Commit to git
git add wp-content/plugins/your-plugin/
git commit -m "Add custom plugin"

# 3. Activate in WordPress
docker-compose exec wordpress wp plugin activate your-plugin
```

### Installing Themes

```bash
# Via Composer (recommended)
docker-compose exec wordpress composer require wpackagist-theme/theme-name

# Via directory (custom theme)
# 1. Place theme in wp-content/themes/your-theme/
# 2. Activate
docker-compose exec wordpress wp theme activate your-theme
```

---

## Database Management

### Backup Database

```bash
# Using WP-CLI
docker-compose exec wordpress wp db export - > backup-$(date +%Y%m%d_%H%M%S).sql

# Using mysqldump directly
docker-compose exec mysql mysqldump -u wp_user -pwp_secure_password wordpress_dev > backup.sql
```

### Restore Database

```bash
# From backup file
docker-compose exec mysql mysql -u wp_user -pwp_secure_password wordpress_dev < backup.sql

# Using WP-CLI
docker-compose exec wordpress wp db import backup.sql
```

### Search and Replace URLs

```bash
# Useful when migrating or testing
docker-compose exec wordpress wp search-replace "oldsite.com" "http://localhost:8080"

# With regex
docker-compose exec wordpress wp search-replace "oldsite\.com" "http://localhost:8080" --regex
```

### Export/Import Posts

```bash
# Export to XML
docker-compose exec wordpress wp export --post_type=post > posts.xml

# Import from XML
docker-compose exec wordpress wp import posts.xml --authors=create
```

---

## Production Deployment

### Pre-Deployment Checklist

1. **Update .env for production**:
```env
WP_ENV=production
WP_DEBUG=false
WP_DEBUG_LOG=false
DISALLOW_FILE_MODS=true
DISALLOW_FILE_EDIT=true
AUTOMATIC_UPDATER_DISABLED=true
```

2. **Generate new security keys**:
```bash
# Visit: https://api.wordpress.org/secret-key/1.1/salt/
# Copy new keys to .env
```

3. **Optimize for production**:
```bash
# Install only production dependencies
docker-compose exec wordpress composer install --no-dev --optimize-autoloader

# Clear all caches
docker-compose exec wordpress wp cache flush
docker-compose exec wordpress wp redis flush
```

### Building for Production

```bash
# Without development dependencies
docker-compose -f docker-compose.yml build --no-cache

# Set production environment
export WP_ENV=production
docker-compose up -d

# Verify production settings
docker-compose exec wordpress wp --info
```

### Health Check

```bash
# Verify WordPress
docker-compose exec wordpress wp --info

# Verify database
docker-compose exec wordpress wp db check

# Verify plugins
docker-compose exec wordpress wp plugin list

# Verify security
curl -I http://localhost:8080/wp/wp-admin/
# Should return 200 OK with security headers
```

---

## Environment Variables Reference

See `.env.example` for complete documentation of all environment variables.

**Key Development Settings**:
- `WP_ENV=development` - Enables debug mode
- `DISALLOW_FILE_MODS=false` - Allows WP-Admin plugin installation (dev only)
- `WP_DEBUG=true` - Enables WordPress debug logging
- `SCRIPT_DEBUG=true` - Use unminified JS/CSS

**Production Settings**:
- `WP_ENV=production` - Disables debug mode
- `DISALLOW_FILE_MODS=true` - Requires Composer for plugins
- `WP_DEBUG=false` - Disables debugging
- `AUTOMATIC_UPDATER_DISABLED=true` - Manual updates only

---

## Git Workflow

### What Gets Committed

✅ **DO Commit**:
- Theme and plugin source code
- `docker/` configuration
- `docker-compose.yml`
- `composer.json`
- `Makefile`
- `.gitignore`, `.env.example`, `README.md`

❌ **DO NOT Commit** (handled by .gitignore):
- `.env` (use `.env.example` template)
- `vendor/` (Composer auto-installs)
- `wp/` (WordPress core, auto-installed)
- `wp-content/uploads/` (user-generated)
- `node_modules/` (npm auto-installs)
- `composer.lock` (developers run composer install)

### Setting Up New Developer Environment

```bash
# 1. Clone repo
git clone <repo-url>
cd BB-WP_Template

# 2. Setup environment
cp .env.example .env

# 3. Start Docker
docker-compose up -d

# 4. Install dependencies
docker-compose exec wordpress composer install
docker-compose exec nodejs npm install

# 5. Done! Start developing
```

---

## Performance Tips

### Enable Redis Caching

```bash
# Already configured in .env
WP_REDIS_HOST=redis
WP_CACHE=true

# Verify it's working
docker-compose exec wordpress wp redis-cli get "test"
```

### Database Optimization

```bash
# Run WordPress database optimization
docker-compose exec wordpress wp db optimize

# Check database status
docker-compose exec wordpress wp db check
docker-compose exec wordpress wp db repair
```

### Enable Query Caching (MySQL)

```bash
# Already configured in docker/mysql/conf.d/wordpress.cnf
# Query cache improves repeated query performance
```

### Monitor Logs in Real-time

```bash
# All logs
docker-compose logs -f

# Specific service
docker-compose logs -f wordpress
docker-compose logs -f nginx
docker-compose logs -f mysql
```

---

## Additional Resources

- [WP Starter Documentation](https://github.com/wecodemore/wpstarter)
- [Bedrock Documentation](https://roots.io/bedrock/)
- [Docker Documentation](https://docs.docker.com/)
- [Composer Documentation](https://getcomposer.org/doc/)
- [WP-CLI Documentation](https://developer.wordpress.org/cli/commands/)
- [Nginx Documentation](https://nginx.org/en/docs/)

---

## Support & Questions

1. **Check existing logs**: `docker-compose logs -f`
2. **Review troubleshooting section** above
3. **Check .env configuration**
4. **Verify Docker resources**: Docker Desktop → Preferences → Resources
5. **Restart everything**: `docker-compose down -v && docker-compose up -d`

---

## License

[Your License Here]

---

**Last Updated**: October 2025  
**Docker Compose**: v2+  
**PHP**: 8.2  
**MySQL**: 8.0  
**WordPress**: 6.8+  
